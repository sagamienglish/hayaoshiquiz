<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>単語クイズ - 生徒用</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #e3f2fd; margin: 0; }
  .container { background: white; padding: 24px; border-radius: 8px; max-width: 400px; margin: 0 auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  input[type="text"] { width: 80%; padding: 10px; font-size: 16px; margin-bottom: 20px; text-align: center; }
  button { padding: 12px 24px; font-size: 18px; cursor: pointer; border: none; border-radius: 4px; background-color: #2196F3; color: white; width: 100%; margin-bottom: 10px; transition: 0.2s;}
  button:hover { background-color: #1976D2; }
  button:disabled { background-color: #ccc; cursor: not-allowed; }
  
  .choice-btn { background-color: #f5f5f5; color: #333; border: 2px solid #ddd; font-weight: bold; text-align: left; padding-left: 20px;}
  .choice-btn:hover:not(:disabled) { background-color: #e0e0e0; }
  
  #question-screen, #result-message { display: none; }
  .score-display { font-size: 1.2em; font-weight: bold; color: #FF9800; margin-bottom: 15px; }
  .status-text { font-size: 1.1em; color: #555; margin: 15px 0; }
</style>
</head>
<body>

<div class="container" id="login-screen">
  <h2>English Quiz</h2>
  <p>名前（ニックネーム）を入力してね</p>
  <input type="text" id="studentName" placeholder="名前">
  <button onclick="joinQuiz()">参加する</button>
</div>

<div class="container" id="question-screen">
  <div class="score-display">現在のスコア: <span id="my-score">0</span> 点</div>
  
  <h3 id="question-info">第 - 問</h3>
  <h2 id="question-text">先生が問題を送信するまでお待ちください...</h2>
  
  <div id="choices-container">
    </div>

  <div id="result-message" class="status-text"></div>
</div>

<script>
  const socket = io();
  let myName = "";
  const choiceLetters = ["A", "B", "C", "D"];

  function joinQuiz() {
    const nameInput = document.getElementById('studentName').value.trim();
    if (!nameInput) {
      alert("名前を入力してください！");
      return;
    }
    myName = nameInput;
    socket.emit('join_game', myName);
    
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('question-screen').style.display = 'block';
  }

  // 自分のスコア更新
  socket.on('sync_score', (score) => {
    document.getElementById('my-score').innerText = score;
  });
  
  // 全員のスコア更新時（自分の分だけ抽出して表示）
  socket.on('sync_scores_all', (players) => {
    if (players[myName] !== undefined) {
      document.getElementById('my-score').innerText = players[myName];
    }
  });

  // 新しい問題を受信
  socket.on('new_question', (data) => {
    document.getElementById('result-message').style.display = 'none';
    document.getElementById('question-info').innerText = `第 ${data.questionNumber} 問 / 全 ${data.totalQuestions} 問`;
    document.getElementById('question-text').innerText = data.question;
    
    const container = document.getElementById('choices-container');
    container.innerHTML = ""; 

    data.choices.forEach((choice, index) => {
      const letter = choiceLetters[index]; // A, B, C, D
      const btn = document.createElement('button');
      btn.className = "choice-btn";
      btn.innerText = `${letter}: ${choice}`;
      btn.onclick = () => submitAnswer(letter);
      container.appendChild(btn);
    });
  });

  // 解答を送信
  function submitAnswer(letter) {
    socket.emit('submit_answer', { name: myName, choice: letter });
    
    // ボタンを無効化して連打防止
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = true);
    
    const msg = document.getElementById('result-message');
    msg.innerText = `「${letter}」を送信しました！結果を待っています...`;
    msg.style.display = 'block';
  }

  // 正解発表を受信
  socket.on('result_announced', (correctChoice) => {
    const msg = document.getElementById('result-message');
    msg.innerHTML = `<span style="color:red; font-size:1.2em; font-weight:bold;">正解は「${correctChoice}」でした！</span>`;
  });

  // 画面リセット（必要に応じて）
  socket.on('clear_student', () => {
    const buttons = document.querySelectorAll('.choice-btn');
    buttons.forEach(btn => btn.disabled = false);
    document.getElementById('result-message').style.display = 'none';
  });
  
  // 全問終了
  socket.on('quiz_finished', () => {
    document.getElementById('question-info').innerText = "クイズ終了！";
    document.getElementById('question-text').innerText = "全問終了しました。先生の画面を見てね！";
    document.getElementById('choices-container').innerHTML = "";
    document.getElementById('result-message').style.display = 'none';
  });
</script>

</body>
</html>
