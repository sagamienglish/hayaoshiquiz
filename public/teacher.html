<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Quiz Teacher Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f0f4f8; margin: 0; padding: 20px; color: #333; }
        h1 { font-family: 'Fredoka One', cursive; font-size: 3rem; text-align: center; color: #ff6b6b; text-shadow: 2px 2px 0px #ffe6e6; margin-bottom: 10px; }
        
        /* æº–å‚™ç”»é¢ */
        #lobby { background: white; max-width: 600px; margin: 0 auto; padding: 30px; border-radius: 15px; box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .settings-group { margin-bottom: 15px; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center;}
        .settings-group input { width: 80px; padding: 5px; font-size: 1.2rem; text-align: center; border-radius: 5px; border: 1px solid #ccc;}
        .user-badge { display: inline-block; background: #007bff; color: white; padding: 8px 15px; border-radius: 20px; margin: 5px; font-weight: bold; font-size: 1.1rem; }
        
        /* ã‚¯ã‚¤ã‚ºç”»é¢ */
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-weight: bold; font-size: 1.2rem; background: #fff; padding: 10px 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .controls { text-align: center; margin-bottom: 20px; }
        button { font-family: 'Fredoka One', cursive; font-size: 1.2rem; padding: 10px 20px; margin: 0 5px; border: none; border-radius: 8px; cursor: pointer; color: white; transition: transform 0.1s, opacity 0.2s; }
        button:hover { transform: translateY(-2px); opacity: 0.9; }
        button:active { transform: translateY(0); }
        .btn-start { background-color: #4CAF50; font-size: 1.5rem; width: 100%; margin-top: 20px; padding: 15px; }
        .btn-reveal { background-color: #9c27b0; }
        .btn-reset { background-color: #6c757d; }
        .btn-next { background-color: #007bff; }
        .btn-finish { background-color: #343a40; display: block; margin: 40px auto; font-size: 1.5rem; }

        /* é¸æŠè‚¢ã®è¡¨ç¤º */
        .container { display: flex; justify-content: space-around; gap: 10px; }
        .choice-box { flex: 1; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .choice-header { padding: 20px 0; text-align: center; color: white; font-size: 2.5rem; font-family: 'Fredoka One', cursive; cursor: pointer; position: relative;}
        .choice-header:hover::after { content: 'æ­£è§£ã«ã™ã‚‹'; position: absolute; top: 10px; right: 10px; font-size: 1rem; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; font-family: 'Noto Sans JP', sans-serif;}
        .bg-A { background-color: #e63946; }
        .bg-B { background-color: #2a9d8f; }
        .bg-C { background-color: #e9c46a; }
        .bg-D { background-color: #264653; }
        ol { padding-left: 20px; margin: 15px; font-size: 1.2rem; font-weight: bold; min-height: 100px;}
        li { margin-bottom: 8px; border-bottom: 1px dashed #ddd; }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ */
        #results { text-align: center; }
        .rank-item { background: white; margin: 10px auto; width: 80%; max-width: 500px; padding: 20px; border-radius: 10px; font-size: 1.5rem; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.1); opacity: 0; transform: translateY(50px); animation: popIn 0.5s forwards; }
        .rank-1 { font-size: 2.5rem; color: #d4af37; background: #fffdf0; border: 3px solid #d4af37;} /* 1ä½ã¯ç‰¹åˆ¥ */
        @keyframes popIn { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="lobby">
        <h1>Quiz Settings</h1>
        <div class="settings-group">æ­£è§£ã®åŸºæœ¬ç‚¹: <input type="number" id="setting-base" value="10"></div>
        <div class="settings-group">æ—©æŠ¼ã—ã®åŠ ç®—ç‚¹: <input type="number" id="setting-bonus" value="5"></div>
        <div class="settings-group">åŠ ç®—ã•ã‚Œã‚‹äººæ•°: <input type="number" id="setting-count" value="1"></div>
        
        <h3 style="text-align: center; margin-top: 30px;">å‚åŠ ä¸­ã®ç”Ÿå¾’</h3>
        <div id="joined-users" style="text-align: center;">ã¾ã èª°ã‚‚ã„ã¾ã›ã‚“...</div>
        
        <button class="btn-start" onclick="startQuiz()">Start Quiz !!</button>
    </div>

    <div id="quiz-screen" style="display: none;">
        <div class="header-info">
            <div>ğŸ’¡ æ­£è§£: <span id="disp-base"></span>ç‚¹ (å…ˆç€<span id="disp-count"></span>åã« +<span id="disp-bonus"></span>ç‚¹)</div>
            <h1>Quiz</h1>
            <div id="current-leaders" style="font-size: 0.9rem; color: #666;"></div>
        </div>

        <div class="controls">
            <button class="btn-reveal" onclick="revealNames()">ğŸ‘€ èª°ãŒæŠ¼ã—ãŸã‹è¦‹ã‚‹ (Reveal)</button>
            <button class="btn-reset" onclick="resetQuestion()">ğŸ”„ åŒã˜å•é¡Œã§ã‚„ã‚Šç›´ã— (Reset)</button>
            <button class="btn-next" onclick="nextQuestion()">â¡ï¸ æ¬¡ã®å•é¡Œã¸ (Next Question)</button>
        </div>
        
        <div class="container">
            <div class="choice-box">
                <div class="choice-header bg-A" onclick="judgeChoice('A')">A</div>
                <ol id="list-A"></ol>
            </div>
            <div class="choice-box">
                <div class="choice-header bg-B" onclick="judgeChoice('B')">B</div>
                <ol id="list-B"></ol>
            </div>
            <div class="choice-box">
                <div class="choice-header bg-C" onclick="judgeChoice('C')">C</div>
                <ol id="list-C"></ol>
            </div>
            <div class="choice-box">
                <div class="choice-header bg-D" onclick="judgeChoice('D')">D</div>
                <ol id="list-D"></ol>
            </div>
        </div>

        <button class="btn-finish" onclick="finishQuiz()">ğŸ Finish this quiz</button>
    </div>

    <div id="results" style="display: none;">
        <h1>Final Results</h1>
        <div id="podium"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentAnswers = { A: [], B: [], C: [], D: [] };
        let isRevealed = false;
        let isJudged = false;
        let currentRanking = [];

        // --- æº–å‚™ç”»é¢ã®å‡¦ç† ---
        socket.on('update_lobby', (names) => {
            const list = document.getElementById('joined-users');
            list.innerHTML = '';
            names.forEach(name => {
                list.innerHTML += `<span class="user-badge">${name}</span>`;
            });
        });

        function startQuiz() {
            const base = document.getElementById('setting-base').value;
            const bonus = document.getElementById('setting-bonus').value;
            const count = document.getElementById('setting-count').value;
            
            socket.emit('update_settings', { basePoints: base, bonusPoints: bonus, bonusCount: count });
            
            document.getElementById('disp-base').textContent = base;
            document.getElementById('disp-bonus').textContent = bonus;
            document.getElementById('disp-count').textContent = count;
            
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
        }

        // --- ã‚¯ã‚¤ã‚ºé€²è¡Œã®å‡¦ç† ---
        socket.on('update_answers_teacher', (answers) => {
            currentAnswers = answers;
            renderAnswers();
        });

        function renderAnswers() {
            ['A', 'B', 'C', 'D'].forEach(choice => {
                const list = document.getElementById(`list-${choice}`);
                list.innerHTML = '';
                currentAnswers[choice].forEach((name) => {
                    const li = document.createElement('li');
                    // Revealã•ã‚Œã‚‹ã¾ã§ã¯éµãƒãƒ¼ã‚¯ã€Revealå¾Œã¯åå‰ã‚’è¡¨ç¤º
                    li.textContent = isRevealed ? name : 'ğŸ”’ (å›ç­”æ¸ˆ)';
                    li.style.color = isRevealed ? '#333' : '#aaa';
                    list.appendChild(li);
                });
            });
        }

        function revealNames() {
            isRevealed = true;
            renderAnswers();
        }

        // å…ˆç”ŸãŒA~Dã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ­£è§£ã‚’åˆ¤å®š
        function judgeChoice(choice) {
            if (isJudged) {
                alert('ã™ã§ã«å¾—ç‚¹ã‚’åŠ ç®—æ¸ˆã¿ã§ã™ã€‚ã€ŒNext Questionã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            if (!isRevealed) {
                alert('å…ˆã«ã€ŒğŸ‘€ èª°ãŒæŠ¼ã—ãŸã‹è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦ã€åå‰ã‚’å…¬é–‹ã—ã¦ãã ã•ã„ï¼');
                return;
            }
            
            if (confirm(`ã€ ${choice} ã€‘ã‚’æ­£è§£ã¨ã—ã¦å¾—ç‚¹ã‚’åŠ ç®—ã—ã¾ã™ã‹ï¼Ÿ`)) {
                isJudged = true;
                socket.emit('judge_answer', choice);
                alert(`æ­£è§£è€…ï¼ˆ${choice}ã‚’é¸ã‚“ã ç”Ÿå¾’ï¼‰ã«å¾—ç‚¹ãŒåŠ ç®—ã•ã‚Œã¾ã—ãŸï¼
